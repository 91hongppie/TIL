

# HTTP

- 세션 계층 프로토콜(www)
- HTML을 기본 프레젠테이션 계층으로 사용
- 목적
  - 전세계 인터넷에 있는 정보를 탐색
- 발명
  - Tim Berners-Lee가 CERN에서 1980년대 말 ~ 1990년대 초

## 동작

- web 자료를 가져와서(GET) 보여주기 
- web에 자료를 Posting 하기(POST)

## URL(Universal Resource Locator)

- http://formal.kau.ac.kr/comnet/index.html
  - http:
    - 프로토콜 이름
  - //formal.kau.ac.kr
    - 호스트 이름
  - /comnet/
    - 디렉토리 이름
  - index.html
    - 파일 이름
- http://formal.kau.ac.kr:8080
  - //formal.kau.ac.kr:8080
    - 호스트 이름
  - :8080/
    - 포트 번호
    - 생략할 수 있다. (포트번호를 입력하지않고 http를 사용하면 기본적으로 80번 포트를 사용)

## HTTP

/-----------------------------------/ 

​				TCP 연결

/-----------------------------------/ 

클라이언트 ----요청 ---> 서버 

클라이언트 <---응답 ---- 서버

/-----------------------------------/ 

​			TCP 연결 종류

/-----------------------------------/ 

- HTTP Transaction  =  Stateless Protocol - 상태가 없다. 요청하고 응답을 받으면 끝. 앞의 요청에 영향을 받지 않는다.
- FTP = Statefull Protocol - 요청, 응답 작용을 하면서 서버에서 클라이언트의 정보를 따라간다(자유도가 떨어진다.)



## GET 요청

- 원하는 자원을 가져오는 목적
- 형식 : HTTP 요청 헤더
  - /------------ 헤더--------------/ 
  - GET  /comnet/  HTTP/1.1
    - /comnet/ = 서버상의 자원의 위치
    - 1.1 = HTTP 버전
  - /--------- 헤더의 끝----------/ 
  - host: formal.kau.ac.kr
  - User-agent: Mozila/5.0 (Macintosh: Intel Mac ......)
  - 마지막에 한 줄을 띄우면 헤더의 끝
- 서버의 응답 
  - /------------ 헤더--------------/ 
  - HTTP/1.1 200 ok
  - Last-modified: 날짜
  - Content-length: 487
  - /--------- 헤더의 끝----------/ 
  - 한 줄을 띄고 바디가 들어간다.
  - /------------ 바디--------------/ 
  - 실제 자원 (파일)
  - /--------- 바디의 끝----------/ 
- GET 방식으로 로그인
  - URI (Universal Resource Identifier)
  - http://formal.kau.ac.kr:8080/comnet?id=kau&pwd=kau

## POST 요청

- 자원을 서버에 게시하고 싶을때
  - 게시판에 글 올리기
  - 사진 올리기
  - 웹 브라우저를 이용해 email 보내기
  - 로그인
- 형식 : 
  - /------------ 헤더--------------/ 
  - POST  /comnet/  HTTP/1.1
  - Host: formal.kau.ac.kr
  - User-agent: Mozila/5.0
  - /--------- 헤더의 끝----------/ 
  - 한 줄을 띄고 바디가 들어간다.
  - /------------ 바디--------------/ 
  - 요청 보내는 내용
  - /--------- 바디의 끝----------/ 

# Cookie

## 웹 응용의 구조

- 웹 클라이언트
  - 현재 홈페이지 - 응용 계층
  - HTML 엔진 - 프레젠테이션 계층
  - HTTP - 세션 계층
- 웹 서버
  - 서버 응용 프로그램 - 로그인 정보, 장바구니 정보, 여기는 Stateless가 아니다.
  - 서버 응용 엔진
  - HTTP - 세션 계층 -> Stateless

## 쿠키란?

- 서버 '응용'이 클라이언트의 이전 작업 정보(state)를 파악하기 위한 도구

## 프로토콜

- HTTP Response 헤더(서버 -> 클라이언트)
  - Set-cookie 라는 필드 
- HTTP Request 헤더(클라이언트 -> 서버)
  - Cookie 라는 필드

## 방법론

- 기억해야할 사항을 쿠키에 담아 클라이언트가 기억하도록하고 서버는 클라이언트의 방문시 주는 쿠키 정보에 맞추어 반응

## 문제

- 클라이언트에 너무 많은 권한과 정보를 준다.
- 해결책: 세션

## 세션

- 클라이언트에게 세션ID 정보만 쿠키로 전달하고 세션들의 특성은 서버가 관리한다.
  - 방문수
    - 쿠키 - 클라이언트에 저장
    - 세션 - 서버에 저장

# HTTP Transaction의 성능향상

- 요청을 하고 응답을 받는 하나의 과정
- 기본 HTTP
  - 요청을 할 때마다 TCP를 연결하고 종결한다.
  - 동사무소에 일이 있을때 하나의 일을 처리하고 나갔다가 다시 들어가서 하나 또 처리하는거랑 비슷
  - 연결하고 종결하는데 300ms 걸린다고 가정하고 요청에 100ms 응답에 150ms 라고 가정하면 4번 요청하고 응답 받는데 850ms * 4 = 3.4s
- Persistent HTTP
  - 서버가 바로 연결을 종결하지 않고 다음 요청을 어느정도 기다리다가 종결한다.
  - 연결하고 종결하는데 300ms 걸린다고 가정하고 요청에 100ms 응답에 150ms 라고 가정하면 4번 요청하고 응답 받는데 250ms * 4 + 300ms + 300ms = 1.6s
- Pipelined HTTP
  - 처음 한번은 요청하고 응답을 받는다.
  - 이미지가 3개 필요하다면 한번에 3번 요청한다.
  - 응답이 순서대로 도착한다.

# 성능

## 성능향상(다중 Transaction)

- 지연시간

  - 패킷을 보내기 시작한 시점에서 패킷을 받기 시작한 시점까지 걸리는 전송 지연 시간

- 전송률

  - 단위 시간 당 전송되는 데이터의 양
  - 초 단위

- 예)

  - 끝단간 지연시간이 100ms이고 전송률이 100MB/s인 네트워크에서 1MB를 전송하여 수신을 완료하는데 걸리는 시간 = 110ms

  1. 끝단간 지연시간 100ms

  2. 전송률 100KB/s

  3. 전송 받고자 하는 정보

     - HTML문서 - 1KB
     - 이미지 3개 
       - 하나당 크기 10KB

  4. HTTP 헤더

     1. Req, Res - 각 1KB

  5. TCP 연결 - 400ms / 종결 - 200ms

  6. TCP연결(400ms) + 지연시간(100ms) + HTTP Req(10ms) + 지연시간(100ms) +  HTTP Res 헤더(10ms) + HTTP Res 바디(10ms) + TCP 종결(200ms)

  7. 정보 수신 완료 시간(이미지 없이 HTML만 수신할 때) = 630ms

     - 전 과정 완료 시간 = 830ms

  8. 이미지 한장 수신 완료 시간 730ms

     - 전 과정 완료 시간 = 930ms

  9. 이미지 세장 수신할 때

     1. 기본 HTTP = 930ms * 3 + 830ms = 3620ms
     2. Persistent HTTP = 3590ms - 600ms * 3 = 1790ms
     3. Pipelined HTTP = TCP연결(400ms) + 지연시간(100ms) + HTTP Req(10ms) + 지연시간(100ms) + HTTP Res 헤더(10ms) + HTTP Res 바디(10ms) + 지연시간(100ms) + HTTP Req 이미지(10ms) + 지연시간(100ms) + (HTTP Res 헤더(10ms) + 이미지 첫번째(100ms)) + (HTTP Res 헤더(10ms)) + 이미지 두번째(100ms) + (HTTP Res 헤더(10ms) + 이미지 세번째(100ms)) + TCP종결(200ms) = 1370ms


## 성능향상2 (네트워트 구조)

### Web Cache(Proxy Server)

- ISP(Internet Service Provider)에서 비용절감을 위하여 이전에 가져온 적이 있는 문서를 DB에 임시 저장해 놓았다가 동일문서가 다시 요청될 때 재사용하는 것
- Web Cache는 중개상인의 개념(Server이자 Client의 역할을 한다.)
- Web Cache가 주는 이득
  - 요청에 대한 응답시간의 단축
  - 제공하는 교통량 증가 - 더 많은 사용자 수용
  - 더 적은 서버 용량으로 더 많은 사용자 지원
